name: SeamCarver

on:
  push:
  pull_request:

jobs:
  build:
    name: Build SeamCarver
    runs-on: ubuntu-latest

    defaults:
      run:
        working-directory: Assignment2_SeamCarving

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install OpenCV
        run: |
          sudo apt-get update
          sudo apt-get install -y libopencv-dev pkg-config

      - name: List project files
        run: ls -R .

      - name: Build SeamCarver
        run: |
          g++ -std=c++17 -DVISUALISE main.cpp SeamCarver.cpp -o seamcarver $(pkg-config --cflags --libs opencv4)

      - name: Run sample image through seam carver
        run: |
          if [ -f input.jpg ]; then
            echo "Processing input.jpg..."
            ./seamcarver input.jpg 1000 800
          else
            echo "No input.jpg found in Assignment2_SeamCarving. Skipping sample generation."
          fi

      - name: Package deliverables
        run: |
          mkdir -p deliverable
          cp seamcarver deliverable/
          if [ -f input.jpg ]; then cp input.jpg deliverable/; fi
          if [ -f output.jpg ]; then cp output.jpg deliverable/; fi
          # README is probably in repo root, so go one level up to copy it
          if [ -f ../README.md ]; then cp ../README.md deliverable/; fi
          zip -r seamcarver_package.zip deliverable/

      - name: Upload packaged artifact
        uses: actions/upload-artifact@v4
        with:
          name: seamcarver-package
          path: Assignment2_SeamCarving/seamcarver_package.zip
